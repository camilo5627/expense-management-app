@using Clases
@model List<Clases.Pago>

@{
    ViewData["Title"] = "Listado de Pagos";
    int mesFiltro = ViewBag.Mes;
    int anioFiltro = ViewBag.Anio;
}

<div class="container mt-4">
    <h2>Pagos del Equipo</h2>

    <div class="alert alert-primary">
        Viendo pagos correspondientes a: <strong>@mesFiltro / @anioFiltro</strong>
    </div>

    <div class="card p-3 mb-3 bg-light">
        <form method="get" action="@Url.Action("ListadoPagosEquipo")">
            <div class="row align-items-end">
                <div class="col-md-4">
                    <label>Mes</label>
                    <input type="number" name="mes" class="form-control" value="@mesFiltro" min="1" max="12" required />
                </div>
                <div class="col-md-4">
                    <label>Año</label>
                    <input type="number" name="anio" class="form-control" value="@anioFiltro" min="2000" required />
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary w-100">Filtrar Mes</button>
                </div>
            </div>
        </form>
    </div>

    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>Fecha de Cobro</th>
                <th>Empleado</th>
                <th>Nombre de Gasto</th>
                <th>Tipo</th>
                <th class="text-end">Monto</th>
            </tr>
        </thead>
        <tbody>
            @foreach (Pago pago in Model)
            {
                <tr>
                    <td>
                        @{
                            DateTime fechaMostrar = pago.FechaCompra;

                            if (pago is PagoRecurrente)
                            {
                                int diaOriginal = pago.FechaCompra.Day;
                                int mesVisual = ViewBag.Mes;
                                int anioVisual = ViewBag.Anio;

                                try
                                {
                                    fechaMostrar = new DateTime(anioVisual, mesVisual, diaOriginal);
                                }
                                catch
                                {
                                    fechaMostrar = new DateTime(anioVisual, mesVisual, 1).AddMonths(1).AddDays(-1);
                                }
                            }
                        }
                        @fechaMostrar.ToShortDateString()
                    </td>
                    <td>@pago.Usuario.Email</td>
                    <td>@pago.Descripcion</td>
                    <td>
                        @if (pago is PagoRecurrente)
                        {
                            <span class="badge bg-success">Recurrente</span>
                        }
                        else
                        {

                            <span class="badge bg-secondary">Único</span>
                        }
                    </td>
                    <td class="text-end">$ @pago.Monto</td>
                </tr>
            }
        </tbody>
    </table>

    @if (Model.Count == 0)
    {
        <div class="alert alert-warning">
            No hay pagos registrados para @mesFiltro/@anioFiltro.
        </div>
    }
</div>